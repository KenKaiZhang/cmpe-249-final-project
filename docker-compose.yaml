services:
  # TransFuser development environment
  transfuser-env:
    container_name: transfuser-env
    build: 
      context: .
      dockerfile: Dockerfile
    image: transfuser-env:latest
    working_dir: /workspace
    network_mode: "host"
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
      - DISPLAY=${DISPLAY:-:0}
      - CARLA_ROOT=/carla
      - PYTHONPATH=/carla/PythonAPI/carla:/transfuser
      - CUDA_VISIBLE_DEVICES=0
    volumes:
      # Mount your existing CARLA installation
      - /mnt/d/Carla/:/workspace/carla:ro
      # Mount your existing TransFuser repo
      - ./:/workspace:rw
      # Mount your datasets
      - /mnt/d/Datasets/:/workspace/datasets
      # Mount directories for outputs (create these locally if they don't exist)
      - ./logs:/workspace/logs
      - ./checkpoints:/workspace/checkpoints
      - ./results:/workspace/results
      # X11 forwarding for GUI (Linux/WSL)
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ${HOME}/.Xauthority:/root/.Xauthority:ro
    stdin_open: true
    tty: true
    shm_size: '16gb'  # Large shared memory for data loading
    ulimits:
      memlock: -1
      stack: 67108864
    gpus: all
    